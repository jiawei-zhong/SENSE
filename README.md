<p align="center">
  <img width="400"  src="https://github.com/jiawei-zhong/SENSE/blob/main/SENSE_logo.jpg">
</p>

# SENSE v1
SENSE (Spatial neighborhood ENrichment analySis and Evaluation) is a R toolkit for quantifying whether cell types preferentially cluster with themselves (homotypic distribution) or with other cell types (heterotypic distribution) based on spatial deconvolution result.


SENSE provides two modules:

#### homotypic score:
- For each spot and cell type, we quantify how much that cell type co-localizes with itself by multiplying its proportion in the spot by the summed proportion in its neighbors.
- The observed value is compared with a null expectation generated by shuffling spot coordinates within each slide and is then normalized by the total abundance of that cell type on the slide.
- Higher scores indicate stronger spatial clustering (self-association) of that cell type.

#### heterotypic score:
- For each pair of cell types, we quantify their co-occurrence by combining (i) their joint presence in the same spot and (ii) their co-enrichment across neighboring spots. 
- The observed value is compared with a permutation-based null model, and the deviation is expressed as a z-score using the permutation mean and standard deviation.
- Positive scores indicate significant spatial co-localization between the two cell types beyond random expectation.

## Installation
SENSE R package can be easily installed from Github using devtools:

```
devtools::install_github("jiawei-zhong/SENSE")
```


## Tutorials
Load required packages:

```
library(SENSE)
library(Seurat)
library(dplyr)
library(parallel)
```
Load Spatial Seurat object, you can download ```depots_STx.RDS``` from [Mendeley Data](https://doi.org/10.17632/8p7k6htgfm.1
        
        
        
        
        
        ):
```
depots_STx <- readRDS("depots_STx.RDS")

# use one slide
depots_STx <- subset(
  depots_STx,
  subset = slide_id == unique(depots_STx$slide_id)[1]
)
# Extract spatial coordinates and deconvolution results
spatial_data <- depots_STx@meta.data[,5:6]
decon_data <- depots_STx@meta.data[,63:122]
```

Replace ```0``` with ```1e-8``` to avoid numerical issues during score calculation:
```
num_cols <- vapply(decon_data, is.numeric, TRUE)

decon_data[, num_cols] <- lapply(
  decon_data[, num_cols, drop = FALSE],
  function(x) replace(x, x == 0, 1e-8)
)
```

Calculate homotypic and heterotypic scores:
```
homotypic_df <- CalHomoScore(
  spatial_data  = spatial_data,
  decon_data    = decon_data,
  n_permutation = 50,
  n_cores       = 50,
  seed          = 123
)

heterotypic_df <- CalHeteroScore(
  spatial_data  = spatial_data,
  decon_data    = decon_data,
  n_permutation = 50,
  n_cores       = 50,
  seed          = 123
)
```

## Citation


## History

#### version 1.0.1 (2025-11-27)

- Fix bug.

#### version 1.0.0 (2025-11-10)

- First release.
